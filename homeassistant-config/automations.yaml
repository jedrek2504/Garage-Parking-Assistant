# automations.yaml

- alias: "Send Distance Thresholds and Brightness to Raspberry Pi"
  trigger:
    - platform: state
      entity_id:
        - input_number.red_distance_threshold_front
        - input_number.orange_distance_threshold_front
        - input_number.red_distance_threshold_left
        - input_number.orange_distance_threshold_left
        - input_number.red_distance_threshold_right
        - input_number.orange_distance_threshold_right
        - input_number.led_brightness
        - input_boolean.parking_system_enabled
  action:
    - service: mqtt.publish
      data:
        topic: "garage/parking/settings"
        payload: >
          {
            "red_distance_threshold_front": {{ states('input_number.red_distance_threshold_front') | int }},
            "orange_distance_threshold_front": {{ states('input_number.orange_distance_threshold_front') | int }},
            "red_distance_threshold_left": {{ states('input_number.red_distance_threshold_left') | int }},
            "orange_distance_threshold_left": {{ states('input_number.orange_distance_threshold_left') | int }},
            "red_distance_threshold_right": {{ states('input_number.red_distance_threshold_right') | int }},
            "orange_distance_threshold_right": {{ states('input_number.orange_distance_threshold_right') | int }},
            "brightness": {{ states('input_number.led_brightness') | int }},
            "enabled": {{ (states('input_boolean.parking_system_enabled') == 'on') | string | lower }}
          }

- alias: "Send Settings on Request"
  trigger:
    - platform: mqtt
      topic: "garage/parking/settings/get"
  action:
    - service: mqtt.publish
      data:
        topic: "garage/parking/settings"
        payload: >
          {
            "red_distance_threshold_front": {{ states('input_number.red_distance_threshold_front') | int }},
            "orange_distance_threshold_front": {{ states('input_number.orange_distance_threshold_front') | int }},
            "red_distance_threshold_left": {{ states('input_number.red_distance_threshold_left') | int }},
            "orange_distance_threshold_left": {{ states('input_number.orange_distance_threshold_left') | int }},
            "red_distance_threshold_right": {{ states('input_number.red_distance_threshold_right') | int }},
            "orange_distance_threshold_right": {{ states('input_number.orange_distance_threshold_right') | int }},
            "brightness": {{ states('input_number.led_brightness') | int }},
            "enabled": {{ (states('input_boolean.parking_system_enabled') == 'on') | string | lower }}
          }
